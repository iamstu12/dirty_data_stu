---
title: "bb_candy_analysis_stu"
author: "Stuart McColl"
date: "12/11/2020"
output: 
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
    
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Analysis Questions

1. What is the total number of candy ratings given across the three years. (number of candy ratings, not number of raters. Don’t count missing values)

2. What was the average age of people who are going out trick or treating and the average age of people not going trick or treating?

3. For each of joy, despair and meh, which candy bar revived the most of these ratings?

4. How many people rated Starburst as despair?

5 What was the most popular candy bar by this rating system for each gender in the dataset?

6. What was the most popular candy bar in each year?

7. What was the most popular candy bar by this rating for people in US, Canada, UK and all other countries?


### Step One
Load Libraries

```{r, warning=FALSE, message=FALSE}

library(tidyverse)

```

### Step Two
Read in Cleaned Data

```{r, warning=FALSE, message=FALSE}

bb_candy_clean <- read_csv("/Users/Natifu/dirty_data_stu/task_4_halloween/clean_data/bb_candy_all_cleaned")

```


### Question 1

#### What is the total number of candy ratings given across the three years. (number of candy ratings, not number of raters. Don’t count missing values)

```{r}

bb_candy_clean %>%
  summarise(number_of_ratings = n())

```

### Question 2

#### What was the average age of people who are going out trick or treating and the average age of people not going trick or treating?

```{r}

bb_candy_clean %>%
  filter(trick_or_treat == TRUE) %>%
  drop_na() %>%
  summarise(average_age_who_do_trick_or_treat = mean(age))

```

```{r}

bb_candy_clean %>%
  filter(trick_or_treat == FALSE) %>%
  drop_na() %>%
  summarise(average_age_who_do_not_trick_or_treat = mean(age))

```

### Question 3

#### For each of joy, despair and meh, which candy bar revived the most of these ratings?

```{r}

bb_candy_clean %>%
  filter(reaction == "joy") %>%
  group_by(item_gifted) %>%
  summarise(joy_count = n()) %>%
  arrange(desc(joy_count)) %>%
  slice(1)

```

```{r}

bb_candy_clean %>%
  filter(reaction == "meh") %>%
  group_by(item_gifted) %>%
  summarise(meh_count = n()) %>%
  arrange(desc(meh_count)) %>%
  slice(1)

```

```{r}

bb_candy_clean %>%
  filter(reaction == "despair") %>%
  group_by(item_gifted) %>%
  summarise(despair_count = n()) %>%
  arrange(desc(despair_count)) %>%
  slice(1)

```

### Question 4

#### How many people rated Starburst as despair?

```{r}

bb_candy_clean %>%
  filter(reaction == "despair",
         item_gifted == "starburst") %>%
  summarise(starburst_despair_count = n())

```

### Question 5

#### Count despair as -1, joy as +1 and meh as 0.

```{r}

bb_candy_clean %>%
  mutate(reaction_code = recode(
    reaction, "despair" = -1,
              "joy" = 1,
              "meh" = 0
    ))

```

### Question 6

#### What was the most popular candy bar by this rating system for each gender in the dataset?

```{r}

bb_candy_clean %>%
  filter(gender == "male") %>%
  group_by(item_gifted) %>%
  summarise(rating_male = n()) %>%
  arrange(desc(rating_male)) %>%
  slice(1)

```

```{r}

bb_candy_clean %>%
  filter(gender == "female") %>%
  group_by(item_gifted) %>%
  summarise(rating_female = n()) %>%
  arrange(desc(rating_female)) %>%
  slice(1)


```

```{r}

bb_candy_clean %>%
  filter(gender == "other") %>%
  group_by(item_gifted) %>%
  summarise(rating_other = n()) %>%
  arrange(desc(rating_other)) %>%
  slice(1)

```

```{r}

bb_candy_clean %>%
  filter(gender == "undisclosed") %>%
  group_by(item_gifted) %>%
  summarise(rating_undisclosed_gender = n()) %>%
  arrange(desc(rating_undisclosed_gender)) %>%
  slice(1)

```

### Question 7

#### What was the most popular candy bar in each year?

```{r}

bb_candy_clean %>%
  filter(date >= "2015-01-01" & date <= "2015-12-31") %>%
  group_by(item_gifted) %>%
  summarise(rating_score_2015 = n()) %>%
  arrange(desc(rating_score_2015)) %>%
  slice(1)
  
```

```{r}

bb_candy_clean %>%
  filter(date >= "2016-01-01" & date <= "2016-12-31") %>%
  group_by(item_gifted) %>%
  summarise(rating_score_2016 = n()) %>%
  arrange(desc(rating_score_2016)) %>%
  slice(1)

```

```{r}

bb_candy_clean %>%
  filter(date >= "2017-01-01" & date <= "2017-12-31") %>%
  group_by(item_gifted) %>%
  summarise(rating_score_2017 = n()) %>%
  arrange(desc(rating_score_2017)) %>%
  slice(1)

```

### Question 8

#### What was the most popular candy bar by this rating for people in US, Canada, UK and all other countries?

```{r}

unique(bb_candy_clean$country)

```


```{r}

bb_candy_clean %>%
  filter(country == "undisclosed") %>%
  group_by(item_gifted) %>%
  summarise(top_candy_undisclosed_country = n()) %>%
  arrange(desc(top_candy_undisclosed_country)) %>%
  slice(1)

```

```{r}

bb_candy_clean %>%
  filter(country == "canada") %>%
  group_by(item_gifted) %>%
  summarise(top_candy_canada = n()) %>%
  arrange(desc(top_candy_canada)) %>%
  slice(1)

```

```{r}

bb_candy_clean %>%
  filter(country == "united states") %>%
  group_by(item_gifted) %>%
  summarise(top_candy_united_states = n()) %>%
  arrange(desc(top_candy_united_states)) %>%
  slice(1)

```

```{r}

bb_candy_clean %>%
  filter(country == "europe") %>%
  group_by(item_gifted) %>%
  summarise(top_candy_europe = n()) %>%
  arrange(desc(top_candy_europe)) %>%
  slice(1)

```

```{r}

bb_candy_clean %>%
  filter(country == "asia") %>%
  group_by(item_gifted) %>%
  summarise(top_candy_asia = n()) %>%
  arrange(desc(top_candy_asia)) %>%
  slice(1)

```

```{r}

bb_candy_clean %>%
  filter(country == "central america") %>%
  group_by(item_gifted) %>%
  summarise(top_candy_central_america = n()) %>%
  arrange(desc(top_candy_central_america)) %>%
  slice(1)

```

```{r}
bb_candy_clean %>%
  filter(country == "new zealand") %>%
  group_by(item_gifted) %>%
  summarise(top_candy_new_zealand = n()) %>%
  arrange(desc(top_candy_new_zealand)) %>%
  slice(1)


```

```{r}

bb_candy_clean %>%
  filter(country == "north america") %>%
  group_by(item_gifted) %>%
  summarise(top_candy_north_america = n()) %>%
  arrange(desc(top_candy_north_america)) %>%
  slice(1)

```

```{r}

bb_candy_clean %>%
  filter(country == "south america") %>%
  group_by(item_gifted) %>%
  summarise(top_candy_south_america = n()) %>%
  arrange(desc(top_candy_south_america)) %>%
  slice(1)

```

```{r}

bb_candy_clean %>%
  filter(country == "africa") %>%
  group_by(item_gifted) %>%
  summarise(top_candy_africa = n()) %>%
  arrange(desc(top_candy_africa)) %>%
  slice(1)

```









